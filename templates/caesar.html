{% extends "base.html" %}
{% block content %}
<div class="card">
    <h2>Caesar Cipher Lab</h2>
    <form method="POST">
        <textarea name="text" placeholder="Enter message..." required></textarea>
        <input type="number" name="shift" placeholder="Shift (1-25) - Leave blank to Brute Force">
        <select name="action">
            <option value="encrypt">Encrypt</option>
            <option value="decrypt">Decrypt</option>
        </select>
        <button type="submit" class="btn-neon">Run Cipher</button>
    </form>

    {% if result %}
    <div class="result-box">
        <h3>Result:</h3>
        <p class="neon-text">{{ result }}</p>
    </div>

    <div class="analysis-section" style="margin-top: 30px;">
        <h3>Cryptanalysis: Frequency Analysis</h3>
        <p>Caesar shifts preserve letter patterns. This breakdown highlights which letters dominate after encryption/decryption.</p>

        {% if freq_stats %}
        <div class="freq-layout">
            <div class="freq-table-wrapper">
                <table class="freq-table">
                    <tr><th>Letter</th><th>Count</th><th>%</th></tr>
                    {% for row in freq_stats %}
                    <tr>
                        <td>{{ row.letter }}</td>
                        <td>{{ row.count }}</td>
                        <td>{{ row.percent }}%</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
        {% endif %}

        {% if chart %}
        <div class="chart-container" style="background: #fff; padding: 10px; border-radius: 8px; margin-top: 15px;">
            <img src="{{ url_for('static', filename='images/' + chart) }}" alt="Frequency Chart">
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if attempts %}
    <h3>Brute Force Results (Hacking Demo)</h3>
    <div class="scroll-table">
        <table>
            <tr><th>Shift</th><th>Message</th></tr>
            {% for item in attempts %}
            <tr><td>{{ item.shift }}</td><td>{{ item.text }}</td></tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}